<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Demo</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d9ff;
        }
        .info-box {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid #00d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .info-box h3 {
            color: #00d9ff;
            margin-bottom: 10px;
        }
        .info-box p {
            color: #ccc;
            line-height: 1.6;
        }
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .panel h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
        }
        select, input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #2a2a4a;
            color: #fff;
            font-size: 14px;
        }
        textarea {
            height: 100px;
            font-family: 'Consolas', monospace;
        }
        button {
            background: linear-gradient(135deg, #00d9ff, #0099cc);
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.4);
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #ff6b6b, #cc5555);
            margin-left: 10px;
        }
        .btn-secondary:hover {
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        .webhooks-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .webhook-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #00d9ff;
        }
        .webhook-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .webhook-event {
            color: #00d9ff;
            font-weight: bold;
        }
        .webhook-time {
            color: #888;
            font-size: 0.85em;
        }
        .webhook-data {
            background: #1a1a2e;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        .status {
            padding: 8px 15px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }
        .status.success {
            display: block;
            background: rgba(0, 255, 100, 0.2);
            border: 1px solid #00ff64;
            color: #00ff64;
        }
        .status.error {
            display: block;
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid #ff6464;
            color: #ff6464;
        }
        .empty-state {
            text-align: center;
            color: #666;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé£ Webhook Demo</h1>
        
        <div class="info-box">
            <h3>What are Webhooks?</h3>
            <p>
                Webhooks are automated HTTP callbacks triggered by events. Instead of polling for updates,
                the server pushes data to your endpoint when something happens. This is commonly used for
                payment notifications, CI/CD pipelines, and real-time integrations.
            </p>
        </div>

        <div class="panel">
            <h2>üì§ Send Webhook</h2>
            <div class="form-group">
                <label>Event Type</label>
                <select id="eventType">
                    <option value="user.created">user.created</option>
                    <option value="user.updated">user.updated</option>
                    <option value="order.completed">order.completed</option>
                    <option value="payment.received">payment.received</option>
                    <option value="subscription.renewed">subscription.renewed</option>
                    <option value="custom">custom event</option>
                </select>
            </div>
            <div class="form-group">
                <label>Payload Data (JSON)</label>
                <textarea id="payloadData">{"userId": "usr_123", "email": "user@example.com"}</textarea>
            </div>
            <button id="sendBtn" onclick="sendWebhook()">Send Webhook</button>
            <div id="sendStatus" class="status"></div>
        </div>

        <div class="panel">
            <h2>üì• Received Webhooks</h2>
            <button onclick="refreshWebhooks()">Refresh</button>
            <button class="btn-secondary" onclick="clearDisplay()">Clear Display</button>
            <div id="webhooksList" class="webhooks-list" style="margin-top: 15px;">
                <div class="empty-state">No webhooks received yet. Send one above!</div>
            </div>
        </div>
    </div>

    <script>
        const WEBHOOK_SERVER = 'http://localhost:4000';
        const WEBHOOK_SECRET = 'my-secret-key';

        // Update payload when event type changes
        document.getElementById('eventType').addEventListener('change', (e) => {
            const payloads = {
                'user.created': '{"userId": "usr_123", "email": "user@example.com", "name": "John Doe"}',
                'user.updated': '{"userId": "usr_123", "changes": {"email": "newemail@example.com"}}',
                'order.completed': '{"orderId": "ord_456", "amount": 99.99, "items": 3}',
                'payment.received': '{"paymentId": "pay_789", "amount": 99.99, "method": "credit_card"}',
                'subscription.renewed': '{"subscriptionId": "sub_101", "plan": "premium"}',
                'custom': '{"key": "value"}'
            };
            document.getElementById('payloadData').value = payloads[e.target.value] || '{}';
        });

        async function sendWebhook() {
            const btn = document.getElementById('sendBtn');
            const status = document.getElementById('sendStatus');
            const event = document.getElementById('eventType').value;
            let data;

            try {
                data = JSON.parse(document.getElementById('payloadData').value);
            } catch (e) {
                status.className = 'status error';
                status.textContent = '‚ùå Invalid JSON payload';
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Sending...';

            try {
                const response = await fetch(`${WEBHOOK_SERVER}/webhook`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Webhook-Secret': WEBHOOK_SECRET
                    },
                    body: JSON.stringify({ event, data })
                });

                const result = await response.json();

                if (response.ok) {
                    status.className = 'status success';
                    status.textContent = `‚úÖ ${result.message} (ID: ${result.id})`;
                    refreshWebhooks();
                } else {
                    status.className = 'status error';
                    status.textContent = `‚ùå ${result.error}`;
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `‚ùå Failed to connect: ${error.message}`;
            }

            btn.disabled = false;
            btn.textContent = 'Send Webhook';
        }

        async function refreshWebhooks() {
            try {
                const response = await fetch(`${WEBHOOK_SERVER}/webhooks`);
                const webhooks = await response.json();
                
                const container = document.getElementById('webhooksList');
                
                if (webhooks.length === 0) {
                    container.innerHTML = '<div class="empty-state">No webhooks received yet. Send one above!</div>';
                    return;
                }

                container.innerHTML = webhooks.reverse().map(webhook => `
                    <div class="webhook-item">
                        <div class="webhook-header">
                            <span class="webhook-event">${webhook.event}</span>
                            <span class="webhook-time">${new Date(webhook.receivedAt).toLocaleString()}</span>
                        </div>
                        <div class="webhook-data">${JSON.stringify(webhook.data, null, 2)}</div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('webhooksList').innerHTML = 
                    '<div class="empty-state">‚ö†Ô∏è Cannot connect to webhook server. Make sure it\'s running!</div>';
            }
        }

        function clearDisplay() {
            document.getElementById('webhooksList').innerHTML = 
                '<div class="empty-state">Display cleared. Click Refresh to reload.</div>';
        }

        // Initial load
        refreshWebhooks();
        
        // Auto-refresh every 5 seconds
        setInterval(refreshWebhooks, 5000);
    </script>
</body>
</html>
